# 更新日志

## 2026-01-31 - 添加编辑和删除功能

### 修改的文件

#### 1. `internal/db/sqlite.go`
添加了两个新的数据库操作方法：

- `UpdateVaultItem(id int, site string, encData []byte) error` - 更新密码条目
- `DeleteVaultItem(id int) error` - 删除密码条目

#### 2. `internal/vault/vault.go`
添加了两个新的管理方法：

- `UpdateItem(keyC []byte, id int, site, itemUser, itemPass string) error` - 更新密码条目（包含加密）
- `DeleteItem(id int) error` - 删除密码条目

#### 3. `cmd/gui/main.go`
做了以下主要修改：

##### a. 修复注册和重置密码时的复制功能
- 添加了独立的"复制到剪贴板"按钮
- 点击按钮会将 Key B 复制到系统剪贴板
- 显示确认提示

##### b. 在登录页面添加"恢复数据"按钮
- 将恢复数据按钮放在注册和重置按钮之间
- 用户可以在登录前恢复备份数据

##### c. 完善密码列表界面
- 将列表从 4 列改为 5 列布局
- 添加了编辑按钮（铅笔图标）
- 添加了删除按钮（垃圾桶图标）
- 改进了复制按钮的反馈提示

##### d. 添加编辑密码对话框
- 新增 `showEditVaultItemDialog()` 函数
- 预填充现有数据
- 支持修改网站、用户名和密码
- 保存后刷新列表

##### e. 添加删除确认对话框
- 删除前显示确认对话框
- 删除成功后显示提示并刷新列表

### 功能说明

#### 编辑密码
1. 在密码列表中点击铅笔图标
2. 在弹出的对话框中修改信息
3. 点击"保存"完成更新
4. 列表自动刷新显示新数据

#### 删除密码
1. 在密码列表中点击垃圾桶图标
2. 在确认对话框中点击"删除"
3. 密码条目被永久删除
4. 列表自动刷新

#### 复制密码到剪贴板（已修复）
- 注册成功后，点击"复制到剪贴板"按钮，Key B 会保存到剪贴板
- 重置密码成功后，也可以使用相同方式复制新的 Key B
- 在密码列表中点击复制图标，密码会复制到剪贴板并显示提示

#### 恢复数据（新增按钮位置）
- 在登录页面即可访问恢复数据功能
- 无需先登录即可恢复备份

### 安全性说明

- 所有更新和删除操作都需要用户已登录（持有 Key C）
- 更新时会重新加密数据
- 删除操作不可恢复，请谨慎操作
- 建议在大量删除前先进行数据备份

### 编译和运行

```bash
# 编译 GUI 版本
cd /Users/zaneway/SynologyDrive/code-space/GolandProjects/learn/key-box
go build -o key-box-gui ./cmd/gui

# 运行
./key-box-gui
```

### 待测试项目

- [ ] 添加密码功能正常
- [ ] 编辑密码功能正常
- [ ] 删除密码功能正常
- [ ] 复制密码到剪贴板功能正常
- [ ] 注册后复制 Key B 功能正常
- [ ] 重置密码后复制 Key B 功能正常
- [ ] 登录页面恢复数据按钮正常
- [ ] 数据加密解密正常
